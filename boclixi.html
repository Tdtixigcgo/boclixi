<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§§ LÃ¬ XÃ¬ TÃ¢m CÆ¡ 2026 ğŸ§§</title>
    <style>
/* ============================================================
   LÃŒ XÃŒ TÃ‚M CÆ  2026 â€” style.css
   Thiáº¿t káº¿: Äá» tháº«m Â· Kim loáº¡i vÃ ng Â· 3D flip Â· Sang trá»ng
   ============================================================ */

:root {
    --red-deep:   #1a0000;
    --red-mid:    #5c0000;
    --red-card:   #a51c1c;
    --red-bright: #c0392b;
    --gold:       #f1c40f;
    --gold-light: #ffe566;
    --gold-dark:  #b8860b;
    --gold-rim:   rgba(241,196,15,0.6);
    --cream:      #fff8e1;
    --green-win:  #27ae60;
    --shadow-heavy: 0 12px 40px rgba(0,0,0,0.7);
}

/* â”€â”€ Reset & Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
    background: radial-gradient(ellipse at 30% 0%, #5a0000 0%, #1a0000 45%, #0d0000 100%);
    color: var(--gold);
    font-family: 'Noto Serif SC', serif;
    min-height: 100vh;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-bottom: 60px;
    position: relative;
}

/* â”€â”€ Background Decorations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.bg-decor {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 0;
    overflow: hidden;
}

.plum { position: absolute; width: 220px; height: 220px; }
.plum-1 { top: 8%; left: 3%; animation: rotateSlowCW 60s linear infinite; }
.plum-2 { bottom: 10%; right: 4%; animation: rotateSlowCCW 80s linear infinite; }

.cloud { position: absolute; width: 340px; height: 140px; }
.cloud-1 { top: 18%; right: -40px; animation: driftLeft 25s ease-in-out infinite alternate; }
.cloud-2 { bottom: 22%; left: -60px; animation: driftRight 30s ease-in-out infinite alternate; }

@keyframes rotateSlowCW  { to { transform: rotate(360deg); } }
@keyframes rotateSlowCCW { to { transform: rotate(-360deg); } }
@keyframes driftLeft  { from { transform: translateX(0); } to { transform: translateX(-30px); } }
@keyframes driftRight { from { transform: translateX(0); } to { transform: translateX(30px); } }

/* â”€â”€ Lanterns â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.lantern-row {
    position: relative;
    z-index: 2;
    display: flex;
    justify-content: space-around;
    width: 100%;
    max-width: 900px;
    padding: 0 40px;
    margin-bottom: -8px;
}

.lantern {
    font-size: 2.2rem;
    display: inline-block;
    transform-origin: top center;
    animation: sway 3.5s ease-in-out infinite;
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5));
}

@keyframes sway {
    0%, 100% { transform: rotate(-9deg); }
    50%       { transform: rotate(9deg); }
}

/* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.site-header {
    position: relative;
    z-index: 2;
    text-align: center;
    padding: 28px 20px 10px;
}

.header-dragon {
    font-size: 3.5rem;
    display: block;
    animation: floatY 3s ease-in-out infinite;
    filter: drop-shadow(0 4px 12px rgba(0,0,0,0.6));
}

@keyframes floatY {
    0%, 100% { transform: translateY(0px) rotate(-2deg); }
    50%       { transform: translateY(-12px) rotate(2deg); }
}

.site-title {
    font-family: 'Ma Shan Zheng', cursive;
    font-size: clamp(2rem, 7vw, 4.2rem);
    color: var(--gold);
    text-shadow:
        0 0 20px rgba(241,196,15,0.9),
        0 0 50px rgba(241,196,15,0.5),
        4px 4px 0 var(--gold-dark),
        8px 8px 20px rgba(0,0,0,0.5);
    letter-spacing: 5px;
    line-height: 1.15;
    margin-top: 4px;
}

.gold-rule {
    width: 240px;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
    margin: 14px auto 10px;
}

.site-subtitle {
    font-size: 0.85rem;
    letter-spacing: 4px;
    color: rgba(241,196,15,0.7);
    margin-bottom: 14px;
}

.site-hint {
    font-size: 1.05rem;
    color: var(--gold-light);
    background: rgba(241,196,15,0.08);
    border: 1px solid rgba(241,196,15,0.2);
    border-radius: 50px;
    display: inline-block;
    padding: 10px 26px;
    letter-spacing: 1px;
    transition: opacity 0.5s;
}

/* â”€â”€ Grid Container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.container {
    position: relative;
    z-index: 2;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 18px;
    padding: 30px 24px;
    max-width: 740px;
    width: 100%;
    perspective: 1200px;
}

@media (max-width: 680px) { .container { grid-template-columns: repeat(3, 1fr); } }
@media (max-width: 480px) { .container { grid-template-columns: repeat(2, 1fr); gap: 12px; } }

/* â”€â”€ LÃ¬ XÃ¬ Card â€” wrapper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.lixi-card {
    position: relative;
    width: 100%;
    aspect-ratio: 2 / 3;
    transform-style: preserve-3d;
    transition: transform 0.75s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    border-radius: 14px;
}

.lixi-card.is-flipped {
    transform: rotateY(180deg);
}

/* Label "Báº N" floating above user card */
.user-label {
    position: absolute;
    top: -13px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--green-win);
    color: #fff;
    font-size: 0.6rem;
    font-weight: 900;
    letter-spacing: 1.5px;
    padding: 3px 12px;
    border-radius: 20px;
    z-index: 5;
    white-space: nowrap;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    animation: labelPulse 1.5s ease-in-out infinite;
}

@keyframes labelPulse {
    0%, 100% { transform: translateX(-50%) scale(1); }
    50%       { transform: translateX(-50%) scale(1.06); }
}

/* â”€â”€ Faces â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.face {
    position: absolute;
    inset: 0;
    border-radius: 14px;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

/* â”€â”€ FRONT face (closed envelope) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.front {
    background: linear-gradient(155deg, #d63031 0%, #a51c1c 50%, #7a1010 100%);
    border: 2px solid var(--gold-dark);
    box-shadow: var(--shadow-heavy), inset 0 1px 0 rgba(255,255,255,0.12);
}

/* Flap triangle */
.front::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 44%;
    background: linear-gradient(155deg, #e04040, #b02020);
    clip-path: polygon(0 0, 100% 0, 50% 100%);
    opacity: 0.6;
}

/* Sheen highlight */
.front::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 50%;
    background: linear-gradient(180deg, rgba(255,255,255,0.1), transparent);
    border-radius: 14px 14px 0 0;
}

.front-seal {
    width: 52px;
    height: 52px;
    border-radius: 50%;
    background: radial-gradient(circle at 35% 35%, var(--gold-light), var(--gold-dark));
    border: 2px solid rgba(255,255,255,0.25);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Ma Shan Zheng', cursive;
    font-size: 1.6rem;
    color: var(--red-mid);
    box-shadow: 0 0 16px rgba(241,196,15,0.7), 0 4px 10px rgba(0,0,0,0.5);
    position: relative;
    z-index: 2;
}

.front-sub {
    font-family: 'Ma Shan Zheng', cursive;
    font-size: 1rem;
    color: var(--gold);
    letter-spacing: 3px;
    margin-top: 8px;
    text-shadow: 0 0 10px rgba(241,196,15,0.5);
    position: relative;
    z-index: 2;
}

.corner-deco {
    position: absolute;
    font-size: 0.75rem;
    color: var(--gold-dark);
    opacity: 0.7;
}
.corner-deco.tl { top: 6px; left: 9px; }
.corner-deco.tr { top: 6px; right: 9px; }
.corner-deco.bl { bottom: 6px; left: 9px; }
.corner-deco.br { bottom: 6px; right: 9px; }

/* â”€â”€ BACK face (revealed prize) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.back {
    transform: rotateY(180deg);
    background: linear-gradient(145deg, #111, #1e1e1e);
    border: 2px solid var(--gold-dark);
    box-shadow: var(--shadow-heavy);
    gap: 8px;
}

/* Texture overlay */
.back::before {
    content: '';
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(
        45deg,
        transparent,
        transparent 12px,
        rgba(255,255,255,0.015) 12px,
        rgba(255,255,255,0.015) 13px
    );
    border-radius: 14px;
}

/* Prize variants */
.back.type-user   { background: linear-gradient(145deg, #001400, #0d2a0d); border-color: var(--green-win); box-shadow: var(--shadow-heavy), 0 0 18px rgba(39,174,96,0.35); }
.back.type-big    { background: linear-gradient(145deg, #1a1400, #2e2400); border-color: var(--gold);      box-shadow: var(--shadow-heavy), 0 0 22px rgba(241,196,15,0.4); animation: goldPulse 1.8s ease-in-out infinite; }
.back.type-small  { background: linear-gradient(145deg, #1a0606, #2d0e0e); border-color: #c0392b; }

@keyframes goldPulse {
    0%, 100% { box-shadow: var(--shadow-heavy), 0 0 22px rgba(241,196,15,0.4); }
    50%       { box-shadow: var(--shadow-heavy), 0 0 40px rgba(241,196,15,0.7); }
}

.prize-icon   { font-size: 2rem; position: relative; z-index: 1; }
.prize-amount {
    font-size: 1.15rem;
    font-weight: 900;
    letter-spacing: 0.5px;
    text-align: center;
    position: relative;
    z-index: 1;
}
.prize-tag {
    font-size: 0.6rem;
    letter-spacing: 2px;
    position: relative;
    z-index: 1;
    opacity: 0.7;
}

.type-user  .prize-amount { color: #2ecc71; text-shadow: 0 0 10px rgba(46,204,113,0.7); }
.type-big   .prize-amount { color: var(--gold); text-shadow: 0 0 12px rgba(241,196,15,0.9); }
.type-small .prize-amount { color: #e57373; }

.type-user  .prize-tag { color: rgba(46,204,113,0.8); }
.type-big   .prize-tag { color: rgba(241,196,15,0.8); }
.type-small .prize-tag { color: rgba(255,100,100,0.7); }

/* â”€â”€ Hover effect on user card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.lixi-card.is-user-card:not(.is-flipped) .front {
    border-color: var(--gold);
    box-shadow: var(--shadow-heavy),
        0 0 30px rgba(241,196,15,0.5),
        0 0 60px rgba(241,196,15,0.2);
    transition: box-shadow 0.3s, border-color 0.3s;
}

.lixi-card.is-user-card:not(.is-flipped):hover .front {
    box-shadow: var(--shadow-heavy),
        0 0 45px rgba(241,196,15,0.8),
        0 0 80px rgba(241,196,15,0.4);
}

.lixi-card.is-user-card:not(.is-flipped):hover {
    animation: cardShake 0.45s ease-in-out;
}

@keyframes cardShake {
    0%, 100% { transform: rotate(0deg) scale(1); }
    20%       { transform: rotate(-3deg) scale(1.04); }
    40%       { transform: rotate(3deg) scale(1.06); }
    60%       { transform: rotate(-2deg) scale(1.04); }
    80%       { transform: rotate(2deg) scale(1.05); }
}

/* â”€â”€ Result Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.result-banner {
    position: relative;
    z-index: 2;
    width: 100%;
    max-width: 560px;
    padding: 0 20px 10px;
    display: none;
    animation: slideUp 0.6s cubic-bezier(0.2, 0.8, 0.3, 1) forwards;
}

.result-banner.show { display: block; }

@keyframes slideUp {
    from { opacity: 0; transform: translateY(30px); }
    to   { opacity: 1; transform: translateY(0); }
}

.result-inner {
    background: linear-gradient(145deg, rgba(90,0,0,0.7), rgba(20,0,0,0.85));
    border: 2px solid var(--gold);
    border-radius: 20px;
    padding: 32px 36px;
    text-align: center;
    box-shadow: 0 0 50px rgba(241,196,15,0.25), var(--shadow-heavy);
    backdrop-filter: blur(4px);
}

.result-icon  { font-size: 3rem; display: block; margin-bottom: 8px; }
.result-label { font-size: 0.9rem; letter-spacing: 3px; color: rgba(241,196,15,0.6); margin-bottom: 4px; }

.result-amount {
    font-size: 3.5rem;
    font-weight: 900;
    color: var(--green-win);
    text-shadow: 0 0 24px rgba(46,204,113,0.7);
    margin: 6px 0 16px;
    line-height: 1;
}

.result-regret {
    font-size: 0.92rem;
    line-height: 1.75;
    color: rgba(255,255,255,0.7);
    border-top: 1px solid rgba(241,196,15,0.2);
    padding-top: 14px;
    margin-top: 4px;
}

.result-regret .hl { color: var(--gold); font-weight: bold; }
.result-regret .hl-green { color: #2ecc71; font-weight: bold; }

/* â”€â”€ Blocker Overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.93);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 999;
    backdrop-filter: blur(6px);
}

.overlay.active { display: flex; }

.popup {
    background: linear-gradient(145deg, #2a0000, #180000);
    border: 3px solid var(--gold);
    border-radius: 24px;
    padding: 48px 56px;
    text-align: center;
    box-shadow: 0 0 80px rgba(241,196,15,0.35), var(--shadow-heavy);
    animation: popIn 0.4s cubic-bezier(0.2, 0.8, 0.3, 1);
    max-width: 420px;
    width: 90%;
}

@keyframes popIn {
    from { opacity: 0; transform: scale(0.7); }
    to   { opacity: 1; transform: scale(1); }
}

.popup-icon  { font-size: 5rem; display: block; margin-bottom: 16px; }

.popup-title {
    font-family: 'Ma Shan Zheng', cursive;
    font-size: 2.2rem;
    color: var(--gold);
    text-shadow: 0 0 16px rgba(241,196,15,0.7);
    margin-bottom: 14px;
}

.popup-msg {
    font-size: 1.1rem;
    color: rgba(255,255,255,0.85);
    line-height: 1.65;
    margin-bottom: 20px;
}

.popup-footer {
    font-size: 0.85rem;
    color: rgba(241,196,15,0.5);
    letter-spacing: 2px;
}

/* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.site-footer {
    position: relative;
    z-index: 2;
    color: rgba(241,196,15,0.2);
    font-size: 0.75rem;
    letter-spacing: 3px;
    margin-top: 30px;
    text-align: center;
}

</style>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;600;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>

    <!-- Decorative SVG Background Layer -->
    <div class="bg-decor" aria-hidden="true">
        <svg class="plum plum-1" viewBox="0 0 200 200"><circle cx="100" cy="60" r="28" fill="rgba(255,215,0,0.12)"/><circle cx="140" cy="90" r="28" fill="rgba(255,215,0,0.12)"/><circle cx="120" cy="130" r="28" fill="rgba(255,215,0,0.12)"/><circle cx="80" cy="130" r="28" fill="rgba(255,215,0,0.12)"/><circle cx="60" cy="90" r="28" fill="rgba(255,215,0,0.12)"/><circle cx="100" cy="100" r="14" fill="rgba(255,160,0,0.15)"/></svg>
        <svg class="plum plum-2" viewBox="0 0 200 200"><circle cx="100" cy="60" r="28" fill="rgba(255,215,0,0.08)"/><circle cx="140" cy="90" r="28" fill="rgba(255,215,0,0.08)"/><circle cx="120" cy="130" r="28" fill="rgba(255,215,0,0.08)"/><circle cx="80" cy="130" r="28" fill="rgba(255,215,0,0.08)"/><circle cx="60" cy="90" r="28" fill="rgba(255,215,0,0.08)"/></svg>
        <svg class="cloud cloud-1" viewBox="0 0 300 120"><ellipse cx="150" cy="80" rx="120" ry="40" fill="rgba(255,215,0,0.05)"/><ellipse cx="100" cy="65" rx="70" ry="35" fill="rgba(255,215,0,0.05)"/><ellipse cx="200" cy="68" rx="80" ry="32" fill="rgba(255,215,0,0.05)"/></svg>
        <svg class="cloud cloud-2" viewBox="0 0 300 120"><ellipse cx="150" cy="80" rx="120" ry="40" fill="rgba(255,215,0,0.04)"/><ellipse cx="100" cy="65" rx="70" ry="35" fill="rgba(255,215,0,0.04)"/><ellipse cx="200" cy="68" rx="80" ry="32" fill="rgba(255,215,0,0.04)"/></svg>
    </div>

    <!-- Lantern Row -->
    <div class="lantern-row" aria-hidden="true">
        <div class="lantern">ğŸ®</div>
        <div class="lantern" style="animation-delay:0.4s">ğŸ®</div>
        <div class="lantern" style="animation-delay:0.8s">ğŸ®</div>
        <div class="lantern" style="animation-delay:1.2s">ğŸ®</div>
        <div class="lantern" style="animation-delay:0.6s">ğŸ®</div>
    </div>

    <!-- Header -->
    <header class="site-header">
        <div class="header-dragon">ğŸ‰</div>
        <h1 class="site-title">Bá»C LÃŒ XÃŒ Äáº¦U XUÃ‚N</h1>
        <div class="gold-rule"></div>
        <p class="site-subtitle">âœ¦ CHÃšC Má»ªNG NÄ‚M Má»šI áº¤T Tá»´ 2026 âœ¦</p>
        <p class="site-hint" id="hint-text">Chá»n má»™t bao lÃ¬ xÃ¬ may máº¯n cá»§a báº¡n ğŸ</p>
    </header>

    <!-- Card Grid â€” JS sáº½ inject 12 .lixi-card vÃ o Ä‘Ã¢y -->
    <main class="container" id="lixi-grid"></main>

    <!-- Result banner (áº©n ban Ä‘áº§u) -->
    <div class="result-banner" id="result-banner">
        <div class="result-inner">
            <div class="result-icon">ğŸŠ</div>
            <div class="result-label">Báº¡n nháº­n Ä‘Æ°á»£c</div>
            <div class="result-amount" id="result-amount"></div>
            <div class="result-regret" id="result-regret"></div>
        </div>
    </div>

    <!-- Blocker Overlay (device lock) -->
    <div class="overlay" id="blocker-overlay">
        <div class="popup">
            <span class="popup-icon">ğŸ˜</span>
            <h2 class="popup-title">Æ  kÃ¬a!</h2>
            <p class="popup-msg" id="error-text"></p>
            <div class="popup-footer">ChÃºc má»«ng nÄƒm má»›i~ ğŸŠ</div>
        </div>
    </div>

    <footer class="site-footer">ğŸ® TÃ‚M CÆ  EDITION Â· NÄ‚M áº¤T Tá»´ 2026 ğŸ®</footer>

    <script>
/* ============================================================
   LÃŒ XÃŒ TÃ‚M CÆ  2026 â€” script.js
   Bá»™ nÃ£o: KhÃ³a thiáº¿t bá»‹ Â· Thao tÃºng káº¿t quáº£ Â· PhÃ¡o hoa
   ============================================================ */

'use strict';

// â”€â”€ DOM refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const grid    = document.getElementById('lixi-grid');
const blocker = document.getElementById('blocker-overlay');
const errText = document.getElementById('error-text');
const hintTxt = document.getElementById('hint-text');
const resBanner = document.getElementById('result-banner');
const resAmount = document.getElementById('result-amount');
const resRegret = document.getElementById('result-regret');

// â”€â”€ Prize config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const USER_PRIZES   = [2000, 5000, 10000, 15000, 18000]; // user chá»‰ trÃºng Ä‘Ã¢y
const BIG_PRIZE     = 100000;
const SMALL_OTHERS  = [1000, 2000, 5000, 10000, 20000, 50000];
const TOTAL_CARDS   = 12;
const BIG_IN_OTHERS = 5;  // sá»‘ bao 100k Ä‘á»ƒ user tiáº¿c nuá»‘i

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let prizes      = [];   // máº£ng 12 pháº§n tá»­
let userIndex   = -1;
let hasPicked   = false;

/* â”€â”€ Audio Engine (Web Audio API) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   KhÃ´ng cáº§n file ngoÃ i, táº¡o Ã¢m thanh trá»±c tiáº¿p                */
let audioCtx = null;

function getAudioCtx() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    return audioCtx;
}

/**
 * Tiáº¿ng "Ting" cao trong tráº»o khi láº­t bao
 */
function playTing(pitch = 1.0) {
    const ctx  = getAudioCtx();
    const osc  = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.type = 'sine';
    osc.frequency.setValueAtTime(1047 * pitch, ctx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(1568 * pitch, ctx.currentTime + 0.12);
    gain.gain.setValueAtTime(0.45, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.9);
    osc.start(ctx.currentTime);
    osc.stop(ctx.currentTime + 0.9);
}

/**
 * Tiáº¿ng phÃ¡o hoa ná»• khi hiá»‡n káº¿t quáº£
 */
function playFirework() {
    const ctx = getAudioCtx();
    const now = ctx.currentTime;
    const notes = [523, 659, 784, 1047, 880, 1175];
    notes.forEach((freq, i) => {
        const osc  = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = i % 2 === 0 ? 'triangle' : 'sawtooth';
        osc.connect(gain);
        gain.connect(ctx.destination);
        const t = now + i * 0.06;
        osc.frequency.setValueAtTime(freq, t);
        osc.frequency.exponentialRampToValueAtTime(freq * 1.4, t + 0.18);
        gain.gain.setValueAtTime(0.18, t);
        gain.gain.exponentialRampToValueAtTime(0.001, t + 0.55);
        osc.start(t);
        osc.stop(t + 0.6);
    });
}

/* â”€â”€ Device Fingerprint â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Táº¡o ID thiáº¿t bá»‹ Ä‘Æ¡n giáº£n tá»« cÃ¡c thÃ´ng sá»‘ trÃ¬nh duyá»‡t         */
function generateDeviceId() {
    const parts = [
        navigator.userAgent,
        `${screen.width}x${screen.height}x${screen.colorDepth}`,
        Intl.DateTimeFormat().resolvedOptions().timeZone,
        navigator.language,
        navigator.hardwareConcurrency || '?',
    ].join('||');

    // FNV-1a hash (nháº¹, khÃ´ng cáº§n crypto)
    let hash = 2166136261;
    for (let i = 0; i < parts.length; i++) {
        hash ^= parts.charCodeAt(i);
        hash = (hash * 16777619) >>> 0; // unsigned 32-bit
    }
    return `lixi2026_${hash.toString(36)}`;
}

/* â”€â”€ checkDevice â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   HÃ m cháº¡y ngay khi load: kiá»ƒm tra Ä‘Ã£ bá»‘c chÆ°a                */
function checkDevice() {
    const deviceId = generateDeviceId();
    const picked   = localStorage.getItem(deviceId);

    if (picked === 'picked') {
        errText.textContent = 'MÃ y Ä‘Ã£ bá»‘c lÃ¬ xÃ¬ rá»“i tham lam gÃ¬ :))';
        blocker.classList.add('active');
        return false; // blocked
    }
    return true; // OK
}

function markDevicePicked() {
    localStorage.setItem(generateDeviceId(), 'picked');
}

/* â”€â”€ generatePrizes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Táº¡o máº£ng 12 pháº§n tá»­ theo luáº­t tÃ¢m cÆ¡                        */
function generatePrizes() {
    // 1) Bao cá»§a user: chá»‰ trÃºng tá»« USER_PRIZES
    const userAmount = USER_PRIZES[Math.floor(Math.random() * USER_PRIZES.length)];

    // 2) 11 bao cÃ²n láº¡i: 5 bao 100k + 6 bao nhá»
    const otherPrizes = [];
    for (let i = 0; i < BIG_IN_OTHERS; i++)
        otherPrizes.push({ amount: BIG_PRIZE, isBig: true, isUser: false });
    for (let i = 0; i < TOTAL_CARDS - 1 - BIG_IN_OTHERS; i++) {
        const amt = SMALL_OTHERS[Math.floor(Math.random() * SMALL_OTHERS.length)];
        otherPrizes.push({ amount: amt, isBig: false, isUser: false });
    }

    // 3) XÃ¡o trá»™n 11 bao kia
    otherPrizes.sort(() => Math.random() - 0.5);

    // 4) ChÃ¨n bao user vÃ o vá»‹ trÃ­ ngáº«u nhiÃªn trong 12
    userIndex = Math.floor(Math.random() * TOTAL_CARDS);
    prizes = [];
    let oi = 0;
    for (let i = 0; i < TOTAL_CARDS; i++) {
        if (i === userIndex) {
            prizes.push({ amount: userAmount, isBig: false, isUser: true });
        } else {
            prizes.push(otherPrizes[oi++]);
        }
    }
}

/* â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
function fmtVND(n) {
    if (n >= 1000) return (n / 1000).toLocaleString('vi-VN') + 'k';
    return n.toLocaleString('vi-VN') + 'Ä‘';
}

function fmtVNDFull(n) {
    return n.toLocaleString('vi-VN') + 'Ä‘';
}

function buildBackClass(prize) {
    if (prize.isUser) return 'type-user';
    if (prize.isBig)  return 'type-big';
    return 'type-small';
}

function buildIcon(prize) {
    if (prize.isUser) return 'ğŸ§§';
    if (prize.isBig)  return 'ğŸ’°';
    return 'ğŸ’¸';
}

function buildTag(prize) {
    if (prize.isUser) return 'ğŸ‰ Cá»¦A Báº N';
    if (prize.isBig)  return 'âœ¨ JACKPOT âœ¨';
    return 'lÃ¬ xÃ¬';
}

/* â”€â”€ renderCards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Render 12 div.lixi-card vÃ o #lixi-grid                      */
function renderCards() {
    grid.innerHTML = '';

    prizes.forEach((prize, idx) => {
        const card = document.createElement('div');
        card.className = 'lixi-card';
        card.dataset.index = idx;

        if (idx === userIndex) card.classList.add('is-user-card');

        // "Báº N" label above user card
        if (idx === userIndex) {
            const lbl = document.createElement('div');
            lbl.className = 'user-label';
            lbl.textContent = 'ğŸ‘† CHá»ŒN ÄI';
            card.appendChild(lbl);
        }

        // Front face
        const front = document.createElement('div');
        front.className = 'face front';
        front.innerHTML = `
            <div class="front-seal">ç¦</div>
            <div class="front-sub">æ˜¥</div>
            <span class="corner-deco tl">âœ¦</span>
            <span class="corner-deco tr">âœ¦</span>
            <span class="corner-deco bl">âœ¦</span>
            <span class="corner-deco br">âœ¦</span>
        `;

        // Back face
        const back = document.createElement('div');
        back.className = `face back ${buildBackClass(prize)}`;
        back.innerHTML = `
            <div class="prize-icon">${buildIcon(prize)}</div>
            <div class="prize-amount">${fmtVNDFull(prize.amount)}</div>
            <div class="prize-tag">${buildTag(prize)}</div>
        `;

        const inner = document.createElement('div');
        inner.style.cssText = 'width:100%;height:100%;position:relative;transform-style:preserve-3d;';
        inner.appendChild(front);
        inner.appendChild(back);
        card.appendChild(inner);

        // Only user card is clickable
        if (idx === userIndex) {
            card.addEventListener('click', () => handleFlip(idx));
            card.style.cursor = 'pointer';
        } else {
            card.style.cursor = 'default';
        }

        grid.appendChild(card);
    });
}

/* â”€â”€ handleFlip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Xá»­ lÃ½ khi user bá»‘c lÃ¬ xÃ¬                                    */
function handleFlip(idx) {
    if (hasPicked) return;  // cháº·n click kÃ©p
    hasPicked = true;

    // Ã‚m thanh
    getAudioCtx(); // unlock audio context (needs user gesture)
    playTing(1.0);

    // ÄÃ¡nh dáº¥u thiáº¿t bá»‹ Ä‘Ã£ bá»‘c
    markDevicePicked();

    // Bá» label + pointer
    const userCard = grid.querySelector(`[data-index="${idx}"]`);
    const lbl = userCard.querySelector('.user-label');
    if (lbl) lbl.remove();
    userCard.style.cursor = 'default';

    // Láº­t bao cá»§a user
    userCard.classList.add('is-flipped');

    // Hint text
    hintTxt.style.opacity = '0';

    // Sau 900ms: láº­t táº¥t cáº£ bao cÃ²n láº¡i (reveal all)
    setTimeout(() => revealAll(idx), 900);
}

/* â”€â”€ revealAll â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Láº­t láº§n lÆ°á»£t 11 bao cÃ²n láº¡i, rá»“i hiá»‡n káº¿t quáº£               */
function revealAll(userIdx) {
    const allCards = grid.querySelectorAll('.lixi-card');
    let delay = 0;

    allCards.forEach((card, i) => {
        if (i === userIdx) return; // Ä‘Ã£ láº­t rá»“i
        delay += 55;
        setTimeout(() => {
            card.classList.add('is-flipped');
            playTing(0.9 + Math.random() * 0.4);
        }, delay);
    });

    // Hiá»‡n káº¿t quáº£ sau khi táº¥t cáº£ láº­t xong
    setTimeout(() => showResult(userIdx), delay + 700);
}

/* â”€â”€ showResult â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Hiá»‡n banner káº¿t quáº£ + confetti + phÃ¡o hoa                    */
function showResult(userIdx) {
    const userPrize = prizes[userIdx];

    // PhÃ¡o hoa Ã¢m thanh
    playFirework();

    // Canvas confetti 3 Ä‘á»£t
    confetti({ particleCount: 130, spread: 80, origin: { y: 0.55 }, colors: ['#f1c40f','#e74c3c','#ff0000','#ffd700','#ffffff'] });
    setTimeout(() => {
        confetti({ angle: 60,  spread: 55, particleCount: 80, origin: { x: 0 },   colors: ['#f1c40f','#ff6b6b'] });
        confetti({ angle: 120, spread: 55, particleCount: 80, origin: { x: 1 },   colors: ['#f1c40f','#ff0000'] });
    }, 350);

    // TÃ­nh danh sÃ¡ch bao 100k Ä‘á»ƒ gÃ¢y tiáº¿c
    const bigList = prizes
        .map((p, i) => ({ ...p, num: i + 1 }))
        .filter((p, i) => i !== userIdx && p.isBig)
        .map(p => `<b>bao sá»‘ ${p.num}</b>`)
        .join(', ');

    // Fill banner
    resAmount.textContent = fmtVNDFull(userPrize.amount);
    resRegret.innerHTML = `
        Báº¡n nháº­n Ä‘Æ°á»£c <span class="hl-green">${fmtVNDFull(userPrize.amount)}</span> ğŸ‰<br><br>
        NhÆ°ng mÃ ... <span class="hl">${BIG_IN_OTHERS} bao 100.000Ä‘</span> náº±m á»Ÿ: ${bigList} ğŸ˜­<br><br>
        <span style="font-size:0.8rem;opacity:0.55">Tiáº¿c khÃ´ng? ThÃ´i nÄƒm sau Ä‘áº¿n sá»›m nha báº¡n Æ¡i~ ğŸ˜‚</span>
    `;

    resBanner.classList.add('show');
    resBanner.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

/* â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Cháº¡y ngay khi DOM sáºµn sÃ ng                                   */
window.addEventListener('DOMContentLoaded', () => {
    const allowed = checkDevice();
    if (!allowed) return; // bá»‹ khÃ³a â†’ dá»«ng láº¡i

    generatePrizes();
    renderCards();
});

</script>
</body>
</html>
